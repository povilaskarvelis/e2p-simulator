<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="description" content="An interactive tool for estimating real-world predictive utility of research findings">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>E2P Simulator | From Effect Size to Real-World Predictive Utility</title>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VDYP5LLPT5"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-VDYP5LLPT5');
    </script>
    
    <!-- Favicon links -->
    <link rel="icon" href="images/favicon.png" type="image/png">
    <link rel="apple-touch-icon" href="images/favicon.png">
    <link rel="canonical" href="https://e2p-simulator.com" />
    
    <!-- Load libraries first -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.1/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Load styles -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/binary.css">
    <link rel="stylesheet" href="css/continuous.css">
    
    <!-- MathJax for professional equation rendering -->
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
    <script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
        },
        svg: {
            scale: 1,                    // global scaling factor
            minScale: .5,               // smallest scaling factor to use
            mtextInheritFont: false,
            merrorInheritFont: true,
            mathmlSpacing: false,        // true for MathML spacing rules, false for TeX rules
            skipAttributes: {},          // RFDa and other attributes NOT to copy to the output
            exFactor: .5,                // default size of ex in em units
            displayAlign: 'center',      // default for indentalign when set to 'auto'
            displayIndent: '0',          // default for indentshift when set to 'auto'
            versionWarning: false,
        },
        options: {
            enableMenu: false,           // disable the MathJax context menu
            menuOptions: {
                settings: {
                    zoom: "Click",       // or "Double-Click" or "None"
                    zscale: "200%",
                }
            }
        }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="site-header">
        <a href="index.html" class="site-title" style="display: inline-flex; align-items: center;">
            <img src="images/favicon.png" alt="E2P Simulator Logo" style="height: 32px; width: 32px; margin-right: 8px;">E2P Simulator
        </a>
        <div class="header-right">
            <nav class="site-nav">
                <a href="index.html" class="nav-link active">Home</a>
                <a href="get-started.html" class="nav-link">Get Started</a>
            </nav>
            <a href="https://github.com/povilaskarvelis/e2p-simulator" target="_blank" rel="noopener noreferrer" class="github-link" aria-label="View source on GitHub">
                <svg viewBox="0 0 98 96" xmlns="http://www.w3.org/2000/svg" class="github-logo"><path fill-rule="evenodd" clip-rule="evenodd" d="M48.854 0C21.839 0 0 22 0 49.217c0 21.756 13.993 40.172 33.405 46.69 2.427.49 3.316-1.059 3.316-2.362 0-1.141-.08-5.052-.08-9.127-13.59 2.934-16.42-5.867-16.42-5.867-2.184-5.704-5.42-7.17-5.42-7.17-4.448-3.015.324-2.958.324-2.958 4.93 1.364 7.496 5.032 7.496 5.032 4.38 7.849 11.564 5.571 14.355 4.239.446-3.281 1.711-5.571 3.074-6.84-10.943-1.243-22.478-5.526-22.478-24.283 0-5.378 1.94-9.778 5.021-13.2-.485-1.243-2.11-6.283.484-13.018 0 0 4.125-1.304 13.426 5.032a46.97 46.97 0 0 1 12.214-1.63c4.125 0 8.33.571 12.213 1.63 9.302-6.336 13.427-5.032 13.427-5.032 2.594 6.735.97 11.775.486 13.018 3.14 3.422 5.021 8.012 5.021 13.2 0 18.807-11.478 23.015-22.478 24.283 1.79 1.548 3.316 4.481 3.316 9.126 0 6.608-.056 11.897-.056 13.526 0 1.304.89 2.853 3.316 2.364 19.412-6.52 33.405-24.935 33.405-46.691C97.707 22 75.788 0 48.854 0z" fill="#24292f"/></svg>
            </a>
        </div>
    </header>

    <!-- Header Container -->
    <h1>From Effect Size to Real-World Predictive Utility</h1>

    <div class="description">
        <p><strong>E2P Simulator</strong> estimates the real-world predictive utility of research findings by accounting for measurement reliability and outcome base rates. It is designed to help researchers interpret findings and plan studies across biomedical and behavioral sciences, particularly in individual differences research, biomarker development, predictive modelling, and precision medicine/psychiatry.</p>

        <p>See <a href="get-started.html" style="color: #0366d6; text-decoration: none;" target="_blank">Get Started</a> guide for more details.</p>

        <p>Developed by <a href="https://povilaskarvelis.github.io/" style="color: #0366d6; text-decoration: none;" target="_blank">Povilas Karvelis</a></p>

    </div>
    
    <!-- Binary Container -->
    <div id="binary-container">
        <!-- Toggle buttons centered and side by side -->
        <div style="display: flex; justify-content: center; margin-bottom: 15px; gap: 20px;">
            <div class="toggle-group">
                <div class="toggle-label">Outcomes</div>
                <div class="toggle-buttons">
                    <button id="binary-button" class="toggle-button mode-toggle binary-mode active">Binary</button>
                    <button id="continuous-button" class="toggle-button mode-toggle continuous-mode">Continuous</button>
                </div>
            </div>
            
            <div class="toggle-group">
                <div class="toggle-label">Effects</div>
                <div class="toggle-buttons">
                    <button id="true-button-bin" class="toggle-button">True</button>
                    <button id="observed-button-bin" class="toggle-button active">Observed</button>
                </div>
            </div>
        </div>
        
        <!-- Main layout container -->
        <div class="main-container">
            <!-- Column 1: Sliders -->
            <div class="slider-section">
                <div class="slider-container">
                    <!-- Cohen's d and other metrics -->
                    <div>
                        <input type="range" id="difference-slider" min="0" max="5" step="0.01" value="1.0" style="width: 100%; margin-bottom: 10px;">
                        
                        <!-- Continuous Metrics -->
                        <div style="display: flex; flex-direction: column; gap: 0px; margin-bottom: 30px;">
                            <div class="metrics-header" style="margin-bottom: 8px;">
                                <span></span>
                                <span>True</span>
                                <span>Obs.</span>
                            </div>

                            <!-- Cohen's d -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span class="slider-label" data-tooltip="Standardized mean difference between groups">Cohen's d</span>
                                <input type="number" id="true-difference-number-bin" class="metrics-input" min="0" max="5" step="0.01" value="1">
                                <input type="number" id="observed-difference-number-bin" class="metrics-input" min="0" max="5" step="0.01" value="1" readonly>
                            </div>

                            <!-- Cohen's U3 -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span class="slider-label" data-tooltip="Proportion of Group 2 that exceeds the median of Group 1">Cohen's U3</span>
                                <input type="number" id="true-cohens-u3-bin" class="metrics-input" min="0" max="1" step="0.01" value="0.84">
                                <input type="number" id="observed-cohens-u3-bin" class="metrics-input" min="0" max="1" step="0.01" value="0.84" readonly>
                            </div>

                            <!-- Odds Ratio -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span class="slider-label" data-tooltip="Ratio of odds of being in group 1 vs group 2">Odds Ratio</span>
                                <input type="number" id="true-odds-ratio-bin" class="metrics-input" min="1" max = "8681" step="0.5" value="1">
                                <input type="number" id="observed-odds-ratio-bin" class="metrics-input" readonly>
                            </div>

                            <!-- Log Odds Ratio -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span class="slider-label" data-tooltip="Natural logarithm of the odds ratio">Log Odds Ratio</span>
                                <input type="number" id="true-log-odds-ratio-bin" class="metrics-input" max = "9.07"step="0.05" value="0">
                                <input type="number" id="observed-log-odds-ratio-bin" class="metrics-input" readonly>
                            </div>

                            <!-- Point-biserial r -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span class="slider-label" data-tooltip="Point-biserial r: correlation between a continuous variable and a binary variable">Point-biserial r</span>
                                <input type="number" id="true-pb-r-bin" class="metrics-input" min="0" max="0.93" step="0.01" value="0">
                                <input type="number" id="observed-pb-r-bin" class="metrics-input" min="0" max="0.93" step="0.01" value="0" readonly>
                            </div>

                            <!-- Eta squared -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span class="slider-label" data-tooltip="Eta squared: proportion of variance explained by group membership">η²</span>
                                <input type="number" id="true-eta-squared-bin" class="metrics-input" min="0" max="0.86" step="0.01" value="0">
                                <input type="number" id="observed-eta-squared-bin" class="metrics-input" min="0" max="1" step="0.01" value="0" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reliability Controls -->
                    <div style="margin-top: 20px; margin-bottom: 15px;">
                        <!-- Group 1 Reliability -->
                        <input type="range" id="icc1-slider" min="0" max="1" step="0.01" value="0.5">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span class="slider-label" data-tooltip="Measurement reliability of the predictor in group 1, expressed as Intraclass Correlation Coefficient">Group 1 reliability, ICC<sub>1</sub></span>
                            <input type="number" id="icc1-number" class="metrics-input permanent-highlight" min="0" max="1" step="0.01" value="0.5">
                        </div>
                        
                        <!-- Group 2 Reliability -->
                        <input type="range" id="icc2-slider" min="0" max="1" step="0.01" value="0.5" style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span class="slider-label" data-tooltip="Measurement reliability of the predictor in group 2, expressed as Intraclass Correlation Coefficient">Group 2 reliability, ICC<sub>2</sub></span>
                            <input type="number" id="icc2-number" class="metrics-input permanent-highlight" min="0" max="1" step="0.01" value="0.5">
                        </div>
                        
                        <!-- Classification Reliability -->
                        <input type="range" id="kappa-slider" min="0" max="1" step="0.01" value="0.5" style="margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span class="slider-label" data-tooltip="Reliability of the group membership, expressed as Cohen's kappa">Grouping reliability, <i>&kappa;</i></span>
                            <input type="number" id="kappa-number" class="metrics-input permanent-highlight" min="0" max="1" step="0.01" value="0.5">
                        </div>
                    </div>

                    <!-- Base rate -->
                    <div>
                        <input type="range" id="base-rate-slider" min="0" max="100" step="0.1" value="50">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                            <span class="slider-label" data-tooltip="Prevalence of group 2 in a population">Base rate (%)</span>
                            <input type="number" id="base-rate-number" class="metrics-input permanent-highlight" min="0" max="100" step="0.1" value="50">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plot 1: Overlapping distributions -->
            <div class="main-plot-section" style="position: relative;">
                <!-- Toggle buttons removed from here -->
                <div id="overlap-plot" class="plot"></div>
                <div class="threshold-buttons" style="position: absolute; top: 10px; right: 10px; display: flex; flex-direction: column; gap: 6px;">
                    <button id="max-j-button" class="toggle-button" style="font-size:0.9rem;padding:6px 12px;" data-tooltip="Set threshold to maximize Youden's J index">max&nbsp;J</button>
                    <button id="max-f1-button" class="toggle-button" style="font-size:0.9rem;padding:6px 12px;" data-tooltip="Set threshold to maximize F1 score">max&nbsp;F1</button>
                </div>
            </div>

                        <!-- Plot 2: ROC, PR and DCA curves -->
                <div class="results-container">
                    <div class="roc-pr-section">
                                                <div class="plot-container">
                        <a href="get-started.html#roc-curves" class="half-plot" style="text-decoration: none; color: inherit;" target="_blank">
                            <div id="roc-plot" style="height: 100%; width: 100%;"></div>
                        </a>
                        <a href="get-started.html#precision-recall" class="half-plot" style="text-decoration: none; color: inherit;" target="_blank">
                            <div id="pr-plot" style="height: 100%; width: 100%;"></div>
                        </a>
                    </div>
                </div>
                
                <div class="dca-section">
                    <div class="plot-container">
                        <a href="get-started.html#dca-analysis" class="full-plot" style="text-decoration: none; color: inherit;" target="_blank">
                            <div id="dca-plot" style="height: 100%; width: 100%;" data-tooltip="Decision curve analysis (DCA)"></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results dashboard -->
        <a href="get-started.html#understanding-metrics" style="text-decoration: none; color: inherit;" target="_blank">
            <div id="dashboard" class="dashboard">
                <div class="dashboard-metrics">
                    <p data-tooltip="Sensitivity; also called True Positive Rate (TPR), Recall">Se: <span id="sensitivity-value">0.00</span></p>
                    <p data-tooltip="Specificity; also called True Negative Rate (TNR)">Sp: <span id="specificity-value">0.00</span></p>
                    <p data-tooltip="Balanced Accuracy">BA: <span id="balanced-accuracy-value">0.00</span></p>
                    <p data-tooltip="Youden's Index">J: <span id="youden-value">0.00</span></p>
                    <p data-tooltip="Positive Likelihood Ratio">LR+: <span id="lr-plus-value">0.00</span></p>
                    <p data-tooltip="Negative Likelihood Ratio">LR-: <span id="lr-minus-value">0.00</span></p>
                    <p data-tooltip="Diagnostic Odds Ratio">DOR: <span id="dor-value">0.00</span></p>
                    <p data-tooltip="Accuracy">Acc: <span id="accuracy-value">0.00</span></p>
                    <p data-tooltip="Negative Predictive Value">NPV: <span id="npv-value">0.00</span></p>
                    <p data-tooltip="Positive Predictive Value; also called Precision">PPV: <span id="precision-value">0.00</span></p>
                    <p data-tooltip="F1 Score">F1: <span id="f1-value">0.00</span></p>
                    <p data-tooltip="Matthews Correlation Coefficient">MCC: <span id="mcc-value">0.00</span></p>
                </div>
            </div>
        </a>
        
        <!-- Equations Section -->
        <div class="equations-container">
            <!-- Reliability attenuation -->
            <div class="equation-box wide">
                <a href="https://osf.io/preprints/psyarxiv/z4yqe_v4" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">Cohen's d attenuation by reliability</p>
                    <div class="equation-content">
                        \[d_{obs} = d_{true} \sqrt{\frac{2ICC_1ICC_2}{ICC_1+ICC_2}\sin\left(\frac{\pi}{2}\kappa\right)}\]
                    </div>
                </a>
            </div>
            
            <!-- d to Log Odds Ratio -->
            <div class="equation-box">
                <a href="https://psycnet.apa.org/buy/2003-10163-006" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">d to Log Odds Ratio</p>
                    <div class="equation-content">
                        \[\log(OR) = \frac{d\pi}{\sqrt{3}}\]
                    </div>
                </a>
            </div>
            
            <!-- d to AUC -->
            <div class="equation-box">
                <a href="https://psycnet.apa.org/record/2008-02525-002" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">d to AUC</p>
                    <div class="equation-content">
                        \[AUC = \Phi\left(\frac{d}{\sqrt{2}}\right)\]
                    </div>
                </a>
            </div>
            
            <!-- d to Point-biserial r -->
            <div class="equation-box">
                <a href="https://psycnet.apa.org/record/2006-22258-004" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">d to Point-biserial r</p>
                    <div class="equation-content">
                        \[r_{pb} = \frac{d}{\sqrt{d^2 + \frac{1}{p(1-p)}}}\]
                    </div>
                </a>
            </div>
            
            <!-- d to Eta squared -->
            <div class="equation-box">
                <a href="https://www.utstat.toronto.edu/brunner/oldclass/378f16/readings/CohenPower.pdf" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">d to Eta squared</p>
                    <div class="equation-content">
                        \[\eta^2 = \frac{d^2}{d^2 + \frac{1}{p(1-p)}}\]
                    </div>
                </a>
            </div>
        </div>

        <!-- Mahalanobis D Calculator -->
        <div style="margin-top: 50px;"></div>
        <h2 style="text-align: center; font-size: 2rem; margin-top: 40px;" class="calculator-title">From Single to Multiple Predictors</h2>
        <div class="description" style="text-align: center; padding: 0 10px; margin-bottom: 20px;">
            <p>
                While the interactive graph above explores a single predictor, here you can estimate the combined effect of multiple predictors and determine how many are needed to achieve a desired level of real-world predictive utility. The combined effect is estimated by first computing Mahalanobis D, a multivariate generalization of Cohen's d, and then computing PR-AUC, which conveys real-world predictive utility by accounting for the base rate. For simplicity, the estimation assumes predictors to have the same effect sizes, uniform collinearity, and no interaction effects.
            </p>
        </div>

        <!-- Mahalanobis D Calculator Container -->
        <div class="container mahalanobis-container">
            <div class="section sliders">
                <!-- Mahalanobis D equation box -->
                <div class="equation-box flat">
                    <p class="equation-title">A simplified Mahalanobis D formula when all predictors have the same effect size and collinearity:</p>
                    <div class="equation-content">
                        \[D = d \sqrt{\dfrac{p}{1 + (p-1)r_{ij}}}\]
                    </div>
                </div>
                
                <div class="form-container">
                    <div>
                        <div style="display: flex; flex-direction: column; gap: 0; margin-bottom: 5px;">
                            <div class="slider-container" style="margin-bottom: 0;">
                                <input type="range" id="targetD-slider" min="0" max="5" step="0.01" value="2.46" class="slider">
                                <div class="slider-value-container">
                                    <span class="slider-label">Target Mahalanobis D</span>
                                    <input type="number" id="targetD" step="0.01" value="2.46" class="slider-value">
                                </div>
                            </div>
                            <div class="slider-value-container" style="margin-top: 0;">
                                <span class="slider-label">Target PR-AUC</span>
                                <input type="number" id="target-pr-auc" class="metrics-input" step="any" readonly="">
                            </div>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="mahalanobis-base-rate-slider" min="0.1" max="99.9" step="0.01" value="10" class="slider">
                            <div class="slider-value-container">
                                <span class="slider-label" data-tooltip="Prevalence of group 2 in a population">Base rate (%)</span>
                                <input type="number" id="mahalanobis-base-rate" min="0.1" max="99.9" step="0.01" value="10" class="slider-value">
                            </div>
                        </div>
                    </div>

                    <hr class="input-separator">

                    <!-- Effect size slider -->
                    <div class="slider-container">
                        <input type="range" id="effectSize-slider" min="0.1" max="2" step="0.01" value="0.8" class="slider">
                        <div class="slider-value-container">
                            <span class="slider-label">Effect size of each predictor (d)</span>
                            <input type="number" id="effectSize" min="0.1" max="2" step="0.01" value="0.8" class="slider-value">
                        </div>
                    </div>

                    <!-- Correlation slider -->
                    <div class="slider-container">
                        <input type="range" id="correlation-slider" min="0" max="1" step="0.01" value="0.1" class="slider">
                        <div class="slider-value-container">
                            <span class="slider-label">Collinearity among predictors (r<sub>ij</sub>)</span>
                            <input type="number" id="correlation" min="0" max="1" step="0.01" value="0.1" class="slider-value">
                        </div>
                    </div>
                    
                    <!-- Number of variables slider -->
                    <div class="slider-container">
                        <input type="range" id="numVariables-slider" min="1" max="100" step="1" value="20" class="slider">
                        <div class="slider-value-container">
                            <span class="slider-label">Number of predictors (p)</span>
                            <input type="number" id="numVariables" min="1" max="100" step="1" value="20" class="slider-value">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button id="record-mahalanobis">Record curve</button>
                        <button id="reset-mahalanobis">Reset</button>
                    </div>
                </div>
            </div>
            <div class="section">
                <div id="chartContainer">
                    <div id="dPlotWrapper" style="position: relative; flex-grow: 1; min-height: 0;">
                        <canvas id="dPlot" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                    </div>
                    <div id="prAucPlotWrapper" style="position: relative; flex-grow: 1; min-height: 0;">
                        <canvas id="prAucPlot" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
            </div>
        </div> 
    </div> 
    
    <!-- Continuous Container -->
    <div id="continuous-container" style="display: none;">
        <!-- Toggle buttons centered and side by side -->
        <div style="display: flex; justify-content: center; margin-bottom: 15px; gap: 20px;">
            <div class="toggle-group">
                <div class="toggle-label">Outcomes</div>
                <div class="toggle-buttons">
                    <button class="toggle-button mode-toggle binary-mode">Binary</button>
                    <button class="toggle-button mode-toggle continuous-mode active">Continuous</button>
                </div>
            </div>
            
            <div class="toggle-group">
                <div class="toggle-label">Effects</div>
                <div class="toggle-buttons">
                    <button id="true-button-cont" class="toggle-button active">True</button>
                    <button id="observed-button-cont" class="toggle-button">Observed</button>
                </div>
            </div>
        </div>
        
        <!-- Main layout container -->
        <div class="main-container">
            <!-- Column 1: Sliders -->
            <div class="slider-section">
                <div class="slider-container">
                    <!-- True and Observed Effects -->
                    <input type="range" id="effect-slider-cont" min="0" max="1" step="0.01" value="0.50" style="width: 100%; margin-bottom: 10px;">

                    <!-- Continuous Metrics -->
                    <div style="display: flex; flex-direction: column; gap: 0px; margin-bottom: 20px;">
                        <div class="metrics-header" style="margin-bottom: 8px;">
                            <span></span>
                            <span>True</span>
                            <span>Obs.</span>
                        </div>

                        <!-- Pearson's r -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Linear correlation between predictor and outcome">Pearson's r</span>
                            <input type="number" id="true-pearson-r-cont" class="metrics-input" min="0" max="1" step="0.01" value="0.50">
                            <input type="number" id="observed-pearson-r-cont" class="metrics-input" min="0" max="1" step="0.01" value="0.50" readonly>
                        </div>

                        <!-- R² -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Proportion of variance in outcome explained by predictor">R²</span>
                            <input type="number" id="true-R-squared-cont" class="metrics-input" min="0" max="1" step="0.01" value="0">
                            <input type="number" id="observed-R-squared-cont" class="metrics-input" min="0" max="1" step="0.01" value="0" readonly>
                        </div>
                    </div>

                    <!-- Reliability X -->
                    <input type="range" id="reliability-x-slider-cont" min="0" max="1" step="0.01" value="0.5">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                        <span class="slider-label" data-tooltip="Measurement reliability of the predictor variable, expressed as Intraclass Correlation Coefficient">Predictor reliability, ICC<sub>x</sub></span>
                        <input type="number" id="reliability-x-number-cont" class="metrics-input permanent-highlight" min="0" max="1" step="0.01" value="0.5">
                    </div>

                    <!-- Reliability Y -->
                    <input type="range" id="reliability-y-slider-cont" min="0" max="1" step="0.01" value="0.5">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                        <span class="slider-label" data-tooltip="Measurement reliability of the outcome variable, expressed as Intraclass Correlation Coefficient">Outcome reliability, ICC<sub>y</sub></span>
                        <input type="number" id="reliability-y-number-cont" class="metrics-input permanent-highlight" min="0" max="1" step="0.01" value="0.5">
                    </div>

                    <!-- Base rate -->
                    <div style="margin-top: 10px; margin-bottom: 20px;">
                        <input type="range" id="base-rate-slider-cont" min="0.1" max="99.9" step="0.1" value="50">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                            <span class="slider-label" data-tooltip="Prevalance of group 2 in a population">Base rate (%)</span>
                            <input type="number" id="base-rate-number-cont" class="metrics-input permanent-highlight" min="0.1" max="99.9" step="0.1" value="50">
                        </div>
                    </div>
                    
                    <hr class="input-separator" style="margin: 20px 0 15px;">
                    
                    <!-- Binary Metrics -->
                    <div style="display: flex; flex-direction: column; gap: 0px; margin-bottom: 15px;">
                        <div class="metrics-header" style="margin-bottom: 5px;">
                            <span></span>
                            <span>True</span>
                            <span>Obs.</span>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Standardized mean difference between groups (using pooled standard deviation)">Cohen's d</span>
                            <input type="number" id="true-cohens-d-cont" class="metrics-input" min="0" max="5" step="0.01" value="0.50" readonly>
                            <input type="number" id="observed-cohens-d-cont" class="metrics-input" min="0" max="5" step="0.01" value="0.50" readonly>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Cohen's d adjusted for unequal group variances (using non-pooled standard deviation)">Cohen's d*</span>
                            <input type="number" id="true-cohens-da-cont" class="metrics-input" min="0" max="5" step="0.01" value="0.50" readonly>
                            <input type="number" id="observed-cohens-da-cont" class="metrics-input" min="0" max="5" step="0.01" value="0.50" readonly>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Proportion of Group 2 that exceeds the median of Group 1">Cohen's U3</span>
                            <input type="number" id="true-cohens-u3-cont" class="metrics-input" min="0" max="1" step="0.01" value="0.69" readonly>
                            <input type="number" id="observed-cohens-u3-cont" class="metrics-input" min="0" max="1" step="0.01" value="0.69" readonly>
                        </div>
                        
                        <!-- Point-biserial r -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Point-biserial r: correlation between a continuous variable and binary group membership">Point-biserial r</span>
                            <input type="number" id="true-pb-r-cont" class="metrics-input" min="0" max="0.93" step="0.01" value="0.00" readonly>
                            <input type="number" id="observed-pb-r-cont" class="metrics-input" min="0" max="0.93" step="0.01" value="0.00" readonly>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Correlation between ranks and binary group membership">Rank-biserial r</span>
                            <input type="number" id="true-rank-biserial-cont" class="metrics-input" min="-1" max="1" step="0.01" value="0.00" readonly>
                            <input type="number" id="observed-rank-biserial-cont" class="metrics-input" min="-1" max="1" step="0.01" value="0.00" readonly>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Mean difference divided by standard deviation of group 1">Glass's &Delta;</span>
                            <input type="number" id="true-glass-d-cont" class="metrics-input" min="0" max="5" step="0.01" value="0.00" readonly>
                            <input type="number" id="observed-glass-d-cont" class="metrics-input" min="0" max="5" step="0.01" value="0.00" readonly>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Ratio of odds of being in group 2 vs group 1">Odds Ratio</span>
                            <input type="number" id="true-odds-ratio-cont" class="metrics-input" min="1" step="1" value="1" readonly>
                            <input type="number" id="observed-odds-ratio-cont" class="metrics-input" min="1" step="1" value="1" readonly>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span class="slider-label" data-tooltip="Natural logarithm of the odds ratio">Log Odds Ratio</span>
                            <input type="number" id="true-log-odds-ratio-cont" class="metrics-input" step="0.05" value="0" readonly>
                            <input type="number" id="observed-log-odds-ratio-cont" class="metrics-input" step="0.05" value="0" readonly>
                        </div>
                    </div>
                    
                    <!-- Precise Estimates Toggle -->
                    <div class="precise-toggle-container" style="margin-top: 25px;">
                        <label for="precise-estimates-checkbox-cont" class="precise-toggle-label">Get precise estimates (slow)</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="precise-estimates-checkbox-cont">
                            <span class="toggle-slider"></span>
                            <span class="toggle-knob"></span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Column 2: Plots -->
            <div class="main-plot-section">
                <!-- Toggle buttons removed from here -->
                <div class="plots-stack">
                    <div class="scatter-plots">
                        <div id="scatter-plot-true-cont" class="plot" style="display: none;"></div>
                        <div id="scatter-plot-observed-cont" class="plot"></div>
                    </div>
                    <div class="distribution-plots">
                        <div id="distribution-plot-true-cont" class="plot" style="display: none;"></div>
                        <div id="distribution-plot-observed-cont" class="plot"></div>
                    </div>
                </div>
            </div>

            <!-- Column 3: ROC, PR and DCA -->
            <div class="results-container">
                <div class="roc-pr-section">
                    <div class="plot-container">
                        <a href="get-started.html#roc-curves" class="half-plot" style="text-decoration: none; color: inherit;" target="_blank">
                            <div id="roc-plot-cont" style="height: 100%; width: 100%;"></div>
                        </a>
                        <a href="get-started.html#precision-recall" class="half-plot" style="text-decoration: none; color: inherit;" target="_blank">
                            <div id="pr-plot-cont" style="height: 100%; width: 100%;"></div>
                        </a>
                    </div>
                </div>
                
                <div class="dca-section">
                    <div class="plot-container">
                        <a href="get-started.html#dca-analysis" class="full-plot" style="text-decoration: none; color: inherit;" target="_blank">
                            <div id="dca-plot-cont" style="height: 100%; width: 100%;" data-tooltip="Decision curve analysis (DCA)"></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results dashboard -->
        <a href="get-started.html#understanding-metrics" style="text-decoration: none; color: inherit;" target="_blank">
            <div id="dashboard-cont" class="dashboard">
                <div class="dashboard-metrics">
                    <p style="display: none;">AUC: <span id="auc-value-cont">0.00</span></p>
                    <p data-tooltip="Sensitivity; also called True Positive Rate (TPR) or Recall">Se: <span id="sensitivity-value-cont">0.00</span></p>
                    <p data-tooltip="Specificity; also called True Negative Rate (TNR)">Sp: <span id="specificity-value-cont">0.00</span></p>
                    <p data-tooltip="Balanced Accuracy">BA: <span id="balanced-accuracy-value-cont">0.00</span></p>
                    <p data-tooltip="Positive Likelihood Ratio">LR+: <span id="lr-plus-value-cont">0.00</span></p>
                    <p data-tooltip="Negative Likelihood Ratio">LR-: <span id="lr-minus-value-cont">0.00</span></p>
                    <p data-tooltip="Diagnostic Odds Ratio">DOR: <span id="dor-value-cont">0.00</span></p>
                    <p data-tooltip="Youden's Index">J: <span id="youden-value-cont">0.00</span></p>
                    <p data-tooltip="Accuracy">Acc: <span id="accuracy-value-cont">0.00</span></p>
                    <p data-tooltip="Negative Predictive Value">NPV: <span id="npv-value-cont">0.00</span></p>
                    <p data-tooltip="Positive Predictive Value; also called Precision">PPV: <span id="ppv-value-cont">0.00</span></p>
                    <p data-tooltip="F1 Score">F1: <span id="f1-value-cont">0.00</span></p>
                    <p data-tooltip="Matthews Correlation Coefficient">MCC: <span id="mcc-value-cont">0.00</span></p>
                </div>
            </div>
        </a>

        <!-- Equations Section for Continuous -->
        <div class="equations-container">
            <!-- Reliability attenuation -->
            <div class="equation-box wider">
                <a href="https://psycnet.apa.org/record/2006-10257-005" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">Reliability attenuation of Pearson's r</p>
                    <div class="equation-content">
                        \[r_{obs} = r_{true} \sqrt{ICC_x \cdot ICC_y}\]
                    </div>
                </a>
            </div>
            
            <!-- Cohen's d -->
            <div class="equation-box wider">
                <a href="https://www.utstat.toronto.edu/brunner/oldclass/378f16/readings/CohenPower.pdf" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">Cohen's d</p>
                    <div class="equation-content">
                        \[d = \frac{\mu_2 - \mu_1}{\sqrt{\frac{(n_1-1)\sigma_1^2 + (n_2-1)\sigma_2^2}{n_1+n_2-2}}}\]
                    </div>
                </a>
            </div>
            
            <!-- Cohen's d* -->
            <div class="equation-box">
                <a href="https://www.frontiersin.org/journals/psychology/articles/10.3389/fpsyg.2013.00863/full" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">Cohen's d*</p>
                    <div class="equation-content">
                        \[d^* = \frac{\mu_2 - \mu_1}{\sqrt{\frac{\sigma_1^2 + \sigma_2^2}{2}}}\]
                    </div>
                </a>
            </div>

            <!-- r to rank-biserial r -->
            <div class="equation-box">
                <a href="https://journals.sagepub.com/doi/abs/10.1177/001316446602600307" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">Rank-biserial correlation</p>
                    <div class="equation-content">
                        \[r_{rb} = \frac{2(\bar{Y}_1 - \bar{Y}_0)}{n}\]
                    </div>
                </a>
            </div>
            
            <!-- Glass's delta -->
            <div class="equation-box">
                <a href="https://journals.sagepub.com/doi/abs/10.3102/0013189x005010003" style="text-decoration: none; color: inherit;" target="_blank">
                    <p class="equation-title">Glass's Δ</p>
                    <div class="equation-content">
                        \[\Delta = \frac{\mu_2 - \mu_1}{\sigma_1}\]
                    </div>
                </a>
            </div>
        </div>

        <!-- Multiple R² Calculator -->
        <div style="margin-top: 50px;"></div>
        <h2 style="text-align: center; font-size: 2rem; margin-top: 40px;" class="calculator-title">From Single to Multiple Predictors</h2>
        <div class="description" style="text-align: center; padding: 0 10px; margin-bottom: 20px;">
            <p>While the interactive graph above explores a single predictor, here you can estimate the combined effect of multiple predictors and determine how many are needed to achieve a desired level of real-world predictive utility. The combined effect is estimated by first computing total variance explained (R²) and then by dichotomizing the data based on the base rate to compute PR-AUC. For simplicity, the model assumes predictors to have the same effect sizes, uniform collinearity, and no interaction effects.</p>
        </div>

        <!-- Multiple R² Calculator Container -->
        <div class="container r-squared-container">
            <div class="section sliders">
                <!-- Multiple R² equation box -->
                <div class="equation-box flat">
                    <p class="equation-title">A simplified multiple R² formula when all predictors have the same effect size and collinearity:</p>
                    <div class="equation-content">
                        \[R^2 = \dfrac{pr^2}{1+(p-1)r_{ij}}\]
                    </div>
                </div>
                
                <div class="form-container">
                    <div>
                        <div style="display: flex; flex-direction: column; gap: 0; margin-bottom: 5px;">
                            <div class="slider-container" style="margin-bottom: 0;">
                                <input type="range" id="target-r2-slider" min="0.1" max="0.99" step="0.01" value="0.8" class="slider">
                                <div class="slider-value-container">
                                    <span class="slider-label">Target R²</span>
                                    <input type="number" id="target-r2" min="0.1" max="0.99" step="0.01" value="0.8" class="slider-value">
                                </div>
                            </div>
                            <div class="slider-value-container" style="margin-top: 0;">
                                <span class="slider-label">Target PR-AUC</span>
                                <input type="number" id="r2-target-pr-auc" class="metrics-input" step="any" readonly="">
                            </div>
                        </div>
                        
                        <!-- Base Rate slider -->
                        <div class="slider-container">
                            <input type="range" id="r2-base-rate-slider" min="0.1" max="99.9" step="0.1" value="15" class="slider">
                            <div class="slider-value-container">
                                <span class="slider-label" data-tooltip="Prevalence of group 2 in a population">Base rate (%)</span>
                                <input type="number" id="r2-base-rate" min="0.1" max="99.9" step="0.1" value="15" class="slider-value">
                            </div>
                        </div>
                    </div>

                    <hr class="input-separator">

                    <!-- Predictor correlation slider -->
                    <div class="slider-container">
                        <input type="range" id="predictor-correlation-slider" min="0.1" max="0.9" step="0.01" value="0.25" class="slider">
                        <div class="slider-value-container">
                            <span class="slider-label">Correlation of each predictor (r)</span>
                            <input type="number" id="predictor-correlation" min="0.1" max="0.9" step="0.01" value="0.25" class="slider-value">
                        </div>
                    </div>
                    
                    <!-- Collinearity slider -->
                    <div class="slider-container">
                        <input type="range" id="collinearity-slider" min="0" max="0.9" step="0.01" value="0.05" class="slider">
                        <div class="slider-value-container">
                            <span class="slider-label">Collinearity among predictors (r<sub>ij</sub>)</span>
                            <input type="number" id="collinearity" min="0" max="0.9" step="0.01" value="0.05" class="slider-value">
                        </div>
                    </div>
                    
                    <!-- Number of predictors slider -->
                    <div class="slider-container">
                        <input type="range" id="num-predictors-r2-slider" min="1" max="100" step="1" value="20" class="slider">
                        <div class="slider-value-container">
                            <span class="slider-label">Number of predictors (p)</span>
                            <input type="number" id="num-predictors-r2" min="1" max="100" step="1" value="20" class="slider-value">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button id="record-r2">Record curve</button>
                        <button id="reset-r2">Reset</button>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div id="r2PlotContainer">
                    <div id="r2PlotWrapper" style="position: relative; flex-grow: 1; min-height: 0;">
                        <canvas id="r2Plot" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                    </div>
                    <div id="r2PrAucPlotWrapper" style="position: relative; flex-grow: 1; min-height: 0;">
                        <canvas id="r2PrAucPlot" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
            </div>
        </div> 
    </div>
    
    <!-- Footer Scripts -->
    <!-- Load shared plugins -->
    <script src="js/shared-plugins.js"></script>
    <!-- Load our module scripts -->
    <script src="js/utils.js"></script>
    <script src="js/binary.js"></script>
    <script src="js/continuous.js"></script>
    <!-- Load main.js last since it depends on the other scripts -->
    <script src="js/main.js"></script>
    <!-- Add this with your other script tags -->
    <script src="js/mahalanobis.js"></script>
    <!-- Add this before the closing body tag -->
    <script src="js/r-squared.js"></script>
    <!-- Add DCA module -->
    <script src="js/dca.js"></script>


    <!-- Footer -->
    <footer style="text-align: center; padding: 20px; margin-top: 40px; border-top: 1px solid #eee;">
        <p style="color: #666; font-size: 0.9em;">
            E2P Simulator is open source software. 
            <a href="https://github.com/povilaskarvelis/e2p-simulator" style="color: #0366d6; text-decoration: none;">View on GitHub</a> | 
            <a href="https://github.com/povilaskarvelis/e2p-simulator/blob/main/LICENSE" style="color: #0366d6; text-decoration: none;">MIT License</a> | 
            <span id="version-info">Version: <span id="version-number">Loading...</span></span>
        </p>
        <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
            Developed by <a href="https://povilaskarvelis.github.io/" style="color: #0366d6; text-decoration: none;" target="_blank">Povilas Karvelis</a>
        </p>
    </footer>

</body>
</html> 
