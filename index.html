<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Understanding Predictive Value of Effect Sizes</title>
    <!-- Load libraries first -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.1/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Load styles -->
    <link rel="stylesheet" href="css/binary.css">
    <link rel="stylesheet" href="css/continuous.css">
    <!-- MathJax for professional equation rendering -->
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <h1>Understanding predictive value of effect sizes</h1>

    <div class="description">
        <p>This interactive tool demonstrates how statistical effect sizes translate into real-world predictive utility, 
        allowing users to explore how measurement reliability and base rates impact predictive metrics.</p>
    </div>

    <!-- Version Selection -->
    <div style="width: 250px; margin-bottom: 20px;">
        <select id="version-select" class="version-select">
            <option value="binary" selected>Binary</option>
            <option value="continuous">Continuous</option>
        </select>
    </div>

    <!-- Binary Version (initially visible) -->
    <div id="binary-container">
        <div class="container">
            <!-- Sliders and inputs -->
            <div class="section sliders">
                <div class="slider-container">
                    <!-- Cohen's d and other metrics -->
                    <div style="margin-bottom: 20px;">
                        <input type="range" id="difference-slider" min="0" max="5" step="0.01" value="0.5" style="width: 100%; margin-bottom: 10px;">
                        
                        <!-- Continuous Metrics -->
                        <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px;">
                            <div style="display: grid; grid-template-columns: 1fr 50px 50px; align-items: center; margin-bottom: 5px;">
                                <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;"> </span>
                                <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;">True</span>
                                <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;">Obs.</span>
                            </div>

                            <!-- Cohen's d -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Cohen's d</span>
                                <input type="number" id="true-difference-number-bin" min="0" max="5" step="0.01" value="0.5" style="width: 50px; text-align: right;">
                                <input type="number" id="observed-difference-number-bin" min="0" max="5" step="0.01" value="1" style="width: 50px; text-align: right;" readonly>
                            </div>

                            <!-- Odds Ratio -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Odds Ratio</span>
                                <input type="number" id="true-odds-ratio-bin" min="1" step="0.01" value="1" style="width: 50px; text-align: right;">
                                <input type="number" id="observed-odds-ratio-bin" min="1" step="0.01" value="1" style="width: 50px; text-align: right;" readonly>
                            </div>

                            <!-- Log Odds Ratio -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Log Odds Ratio</span>
                                <input type="number" id="true-log-odds-ratio-bin" step="0.05" value="0" style="width: 50px; text-align: right;">
                                <input type="number" id="observed-log-odds-ratio-bin" step="0.05" value="0" style="width: 50px; text-align: right;" readonly>
                            </div>

                            <!-- AUC -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">AUC</span>
                                <input type="number" id="true-auc-bin" min="0.5" max="1" step="0.01" value="0.1" style="width: 50px; text-align: right;">
                                <input type="number" id="observed-auc-bin" min="0.5" max="1" step="0.01" value="0.1" style="width: 50px; text-align: right;" readonly>
                            </div>

                            <!-- Point-biserial r -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">r<sub>pb</sub></span>
                                <input type="number" id="true-pb-r-bin" min="0" max="1" step="0.01" value="0" style="width: 50px; text-align: right;">
                                <input type="number" id="observed-pb-r-bin" min="0" max="1" step="0.01" value="0" style="width: 50px; text-align: right;" readonly>
                            </div>

                            <!-- Eta squared -->
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">&eta;²</span>
                                <input type="number" id="true-eta-squared-bin" min="0" max="1" step="0.01" value="0" style="width: 50px; text-align: right;">
                                <input type="number" id="observed-eta-squared-bin" min="0" max="1" step="0.01" value="0" style="width: 50px; text-align: right;" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Base rate -->
                    <div>
                        <input type="range" id="base-rate-slider" min="0" max="100" step="0.1" value="50" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                            <span style="font-size: 1.1em; color: #555;">Base rate (%)</span>
                            <input type="number" id="base-rate-number" min="0" max="100" step="0.1" value="50" style="width: 60px;">
                        </div>
                    </div>

                    <!-- Reliability Controls -->
                    <div style="margin-top: 30px;">
                        <!-- Group 1 Reliability -->
                        <input type="range" id="icc1-slider" min="0" max="1" step="0.01" value="0.5" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span style="font-size: 1.1em; color: #555;">Group 1 reliability</span>
                            <input type="number" id="icc1-number" min="0" max="1" step="0.01" value="0.5" style="width: 60px;">
                        </div>
                        
                        <!-- Group 2 Reliability -->
                        <input type="range" id="icc2-slider" min="0" max="1" step="0.01" value="0.5" style="width: 100%; margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span style="font-size: 1.1em; color: #555;">Group 2 reliability</span>
                            <input type="number" id="icc2-number" min="0" max="1" step="0.01" value="0.5" style="width: 60px;">
                        </div>
                        
                        <!-- Classification Reliability -->
                        <input type="range" id="iccc-slider" min="0" max="1" step="0.01" value="0.5" style="width: 100%; margin-top: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span style="font-size: 1.1em; color: #555;">Grouping reliability</span>
                            <input type="number" id="iccc-number" min="0" max="1" step="0.01" value="0.5" style="width: 60px;">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Plot 1: Overlapping distributions -->
            <div class="section">
                <!-- Toggle buttons -->
                <div style="text-align: left; margin-bottom: 10px;">
                    <button id="true-button-bin" class="toggle-button">True</button>
                    <button id="observed-button-bin" class="toggle-button active">Observed</button>
                </div>
                <div id="overlap-plot" class="plot"></div>
            </div>

            <!-- Plot 2: ROC curve -->
            <div class="section">
                <div class="plot-container">
                    <div id="roc-plot" class="half-plot"></div>
                    <div id="pr-plot" class="half-plot"></div>
                </div>
            </div>
        </div>

        <!-- Results dashboard -->
        <div id="dashboard" class="dashboard" style="padding-left: 100px; padding-right: 100px;">
            <div style="display: flex; justify-content: space-between; flex-wrap: wrap;">
                <p style="display: none;">AUC: <span id="auc-value">0.00%</span></p>
                <p>Balanced accuracy: <span id="accuracy-value">0.00%</span></p>
                <p>Sensitivity: <span id="sensitivity-value">0.00%</span></p>
                <p>Specificity: <span id="specificity-value">0.00%</span></p>
                <p>PPV: <span id="ppv-value">0.00%</span></p>
            </div>
        </div>
        
        <!-- Equations Section -->
        <div class="equations-container">
            <!-- Reliability attenuation -->
            <div class="equation-box equation-wide">
                <p class="equation-title">Cohen's d attenuation by reliability</p>
                <div class="equation-content">
                    \[d_{obs} = d_{true} \times \sqrt{\frac{2r_1r_2}{r_1+r_2} \times r_g}\]
                </div>
            </div>
            
            <!-- d to Log Odds Ratio -->
            <div class="equation-box">
                <p class="equation-title">Cohen's d to Log Odds Ratio</p>
                <div class="equation-content">
                    \[\log(OR) = \frac{d\pi}{\sqrt{3}}\]
                </div>
            </div>
            
            <!-- d to AUC -->
            <div class="equation-box">
                <p class="equation-title">Cohen's d to AUC</p>
                <div class="equation-content">
                    \[AUC = \Phi\left(\frac{d}{\sqrt{2}}\right)\]
                </div>
            </div>
            
            <!-- d to Point-biserial r -->
            <div class="equation-box">
                <p class="equation-title">Cohen's d to Point-biserial r</p>
                <div class="equation-content">
                    \[r_{pb} = \frac{d}{\sqrt{d^2 + 4}}\]
                </div>
            </div>
            
            <!-- d to Eta squared -->
            <div class="equation-box">
                <p class="equation-title">Cohen's d to Eta squared</p>
                <div class="equation-content">
                    \[\eta^2 = \frac{d^2}{d^2 + 4}\]
                </div>
            </div>
        </div>

        <div style="margin-top: 50px;"></div>
        <!-- Mahalanobis D Calculator Header -->
        <h2 style="text-align: center; font-size: 2em; margin-top: 40px;">Mahalanobis D Calculator</h2>
        <div class="description" style="text-align: center; padding: 0 100px; margin-bottom: 20px;">
            <p>This calculator shows how multiple correlated predictors combine to create group separation in multivariate space. 
            Mahalanobis D extends Cohen's d to multiple dimensions while accounting for correlations between measures. This comes with some simplifying
            assumptions, including multivariate normality, equal covariance matrices between groups, and no interaction effects among predictors.
            Use this to estimate how many predictors you need to achieve a target level of group separation.</p>
        </div>

        <!-- Mahalanobis D Calculator Container -->
        <div class="container mahalanobis-container" style="grid-template-columns: 1.5fr 1fr;">
            <div class="section sliders">
                <!-- Mahalanobis D equation box -->
                <div class="equation-box equation-wide" style="margin: 0 auto 20px auto; width: 320px;">
                    <p class="equation-title">Mahalanobis D formula</p>
                    <div class="equation-content">
                        \[D = d \times \sqrt{\frac{n}{1 + (n-1) \times r}}\]
                    </div>
                </div>
                
                <div class="form-container" style="padding: 0 20px; padding-top: 10px; padding-bottom: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 1.1em; color: #555;">Needed Mahalanobis D</span>
                        <input type="number" id="neededD" title="Enter the needed Mahalanobis D" step="0.01" value="3" style="width: 60px; margin-right: 0;" required>
                    </div>

                    <!-- Effect size slider -->
                    <div style="display: flex; flex-direction: column; margin-top: 15px;">
                        <input type="range" id="effectSize-slider" min="0.1" max="2" step="0.01" value="0.5" style="width: 100%; accent-color: #222222;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span style="font-size: 1.1em; color: #555;">Effect size of each predictor (d)</span>
                            <input type="number" id="effectSize" min="0.1" max="2" step="0.01" value="0.5" style="width: 60px; margin-right: 0;">
                        </div>
                    </div>

                    <!-- Correlation slider -->
                    <div style="display: flex; flex-direction: column; margin-top: 15px;">
                        <input type="range" id="correlation-slider" min="0" max="1" step="0.01" value="0.1" style="width: 100%; accent-color: #222222;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span style="font-size: 1.1em; color: #555;">Collinearity among predictors (r)</span>
                            <input type="number" id="correlation" min="0" max="1" step="0.01" value="0.1" style="width: 60px; margin-right: 0;">
                        </div>
                    </div>

                    <!-- Number of variables slider -->
                    <div style="display: flex; flex-direction: column; margin-top: 15px;">
                        <input type="range" id="numVariables-slider" min="1" max="100" step="1" value="50" style="width: 100%; accent-color: #222222;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                            <span style="font-size: 1.1em; color: #555;">Number of predictors</span>
                            <input type="number" id="numVariables" min="1" max="100" step="1" value="50" style="width: 60px; margin-right: 0;">
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button id="record-mahalanobis" style="flex: 2;">Record curve</button>
                        <button id="reset-mahalanobis" style="flex: 1;">Reset</button>
                    </div>
                </div>
            </div>
            <div class="section" style="padding: 20px;">
                <div id="chartContainer">
                    <canvas id="dPlot"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Continuous Version (initially hidden) -->
    <div id="continuous-container" style="display: none;">
        <div class="container">
            <!-- Column 1: Sliders -->
            <div class="section sliders">
                <div class="slider-container">
                    <!-- True and Observed Effects -->
                    <input type="range" id="effect-slider-cont" min="0" max="1" step="0.01" value="0.50" style="width: 100%; margin-bottom: 10px;">

                    <!-- Continuous Metrics -->
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: 1fr 50px 50px; align-items: center; margin-bottom: 5px;">
                            <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;"> </span>
                            <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;">True</span>
                            <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;">Obs.</span>
                        </div>

                        <!-- Pearson's r -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Pearson's r</span>
                            <input type="number" id="true-pearson-r-cont" min="0" max="1" step="0.01" value="0.50" style="width: 50px; text-align: right;">
                            <input type="number" id="observed-pearson-r-cont" min="0" max="1" step="0.01" value="0.50" style="width: 50px; text-align: right;" readonly>
                        </div>

                        <!-- R² -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">R²</span>
                            <input type="number" id="true-R-squared-cont" min="0" max="1" step="0.01" value="0" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-R-squared-cont" min="0" max="1" step="0.01" value="0" style="width: 50px; text-align: right;" readonly>
                        </div>

                        <!-- c-index -->
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">c-index</span>
                            <input type="number" id="true-c-index-cont" min="0.5" max="1" step="0.001" value="0.5" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-c-index-cont" min="0.5" max="1" step="0.001" value="0.5" style="width: 50px; text-align: right;" readonly>
                        </div>
                    </div>

                    <!-- Reliability X -->
                    <input type="range" id="reliability-x-slider-cont" min="0" max="1" step="0.01" value="0.5" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                        <span style="font-size: 1.1em; color: #555;">Predictor reliability</span>
                        <input type="number" id="reliability-x-number-cont" min="0" max="1" step="0.01" value="0.5" style="width: 60px;">
                    </div>

                    <!-- Reliability Y -->
                    <input type="range" id="reliability-y-slider-cont" min="0" max="1" step="0.01" value="0.5" style="width: 100%;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                        <span style="font-size: 1.1em; color: #555;">Outcome reliability</span>
                        <input type="number" id="reliability-y-number-cont" min="0" max="1" step="0.01" value="0.5" style="width: 60px;">
                    </div>

                    <!-- Base rate -->
                    <div style="margin-top: 30px; margin-bottom: 30px;">
                        <input type="range" id="base-rate-slider-cont" min="0.1" max="99.9" step="0.1" value="50" style="width: 100%;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
                            <span style="font-size: 1.1em; color: #555;">Base rate (%)</span>
                            <input type="number" id="base-rate-number-cont" min="0.1" max="99.9" step="0.1" value="50" style="width: 60px;">
                        </div>
                    </div>

                    <!-- Binary Metrics -->
                    <div style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 30px;">
                        <div style="display: grid; grid-template-columns: 1fr 50px 50px; align-items: center; margin-bottom: 5px;">
                            <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;"> </span>
                            <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;">True</span>
                            <span style="text-align: left; font-size: 0.8em; font-weight: bold; color: #555;">Obs.</span>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Cohen's d</span>
                            <input type="number" id="true-cohens-d-cont" min="0" max="5" step="0.01" value="0.50" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-cohens-d-cont" min="0" max="5" step="0.01" value="0.50" style="width: 50px; text-align: right;" readonly>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Cohen's d*</span>
                            <input type="number" id="true-cohens-da-cont" min="0" max="5" step="0.01" value="0.50" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-cohens-da-cont" min="0" max="5" step="0.01" value="0.50" style="width: 50px; text-align: right;" readonly>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Rank-biserial r</span>
                            <input type="number" id="true-rank-biserial-cont" min="-1" max="1" step="0.01" value="0.00" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-rank-biserial-cont" min="-1" max="1" step="0.01" value="0.00" style="width: 50px; text-align: right;" readonly>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Glass's &Delta;</span>
                            <input type="number" id="true-glass-d-cont" min="0" max="5" step="0.01" value="0.00" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-glass-d-cont" min="0" max="5" step="0.01" value="0.00" style="width: 50px; text-align: right;" readonly>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Odds Ratio</span>
                            <input type="number" id="true-odds-ratio-cont" min="1" step="1" value="1" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-odds-ratio-cont" min="1" step="1" value="1" style="width: 50px; text-align: right;" readonly>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">Log Odds Ratio</span>
                            <input type="number" id="true-log-odds-ratio-cont" step="0.05" value="0" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-log-odds-ratio-cont" step="0.05" value="0" style="width: 50px; text-align: right;" readonly>
                        </div>

                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <span style="font-size: 1.1em; color: #555; text-align: left; flex: 1;">AUC</span>
                            <input type="number" id="true-auc-cont" min="0.5" max="1" step="0.005" value="0.1" style="width: 50px; text-align: right;" readonly>
                            <input type="number" id="observed-auc-cont" min="0.5" max="1" step="0.005" value="0.1" style="width: 50px; text-align: right;" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Column 2: Plots -->
            <div class="section plot-container">
                <!-- Toggle buttons -->
                <div style="text-align: left; margin-bottom: 10px;">
                    <button id="true-button-cont" class="toggle-button active">True</button>
                    <button id="observed-button-cont" class="toggle-button">Observed</button>
                </div>
                <div class="container secondary">
                    <!-- Container for both plots -->
                    <div class="plots-stack">
                        <div class="scatter-plots">
                            <div id="scatter-plot-true-cont" class="plot" style="display: none;"></div>
                            <div id="scatter-plot-observed-cont" class="plot"></div>
                        </div>
                        <div class="distribution-plots">
                            <div id="distribution-plot-true-cont" class="plot" style="display: none;"></div>
                            <div id="distribution-plot-observed-cont" class="plot"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Column 3: ROC and Dashboard -->
            <div class="section results-container">
                <div class="plot-container">
                    <div id="roc-plot-cont" class="half-plot"></div>
                    <div id="pr-plot-cont" class="half-plot"></div>
                </div>
                <div id="dashboard-cont" class="dashboard" style="padding-left: 10px; padding-right: 10px;">
                    <p style="display: none;">AUC: <span id="auc-value-cont">0.00%</span></p>
                    <p>Balanced accuracy: <span id="accuracy-value-cont">0.00%</span></p>
                    <p>Sensitivity: <span id="sensitivity-value-cont">0.00%</span></p>
                    <p>Specificity: <span id="specificity-value-cont">0.00%</span></p>
                    <p>PPV: <span id="ppv-value-cont">0.00%</span></p>
                </div>
            </div>
        </div>

    <!-- Multivariate R² Calculator Section -->
    <div style="margin-top: 50px;"></div>
    <h2 style="text-align: center; font-size: 2em; margin-top: 40px;">Multivariate R² Calculator</h2>
    <div class="description" style="text-align: center; padding: 0 100px; margin-bottom: 20px;">
        <p>This calculator shows how multiple correlated predictors combine to create explained variance in multivariate regression. 
        It accounts for intercorrelations among predictors, helping you understand the unique contribution of each variable.
        Use this to estimate how predictive power changes as you add correlated predictors to your model.</p>
    </div>

    <!-- Multivariate R² Calculator Container -->
    <div class="container r-squared-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; max-width: 1200px; margin: 0 auto;">
        <div class="section sliders" style="background-color: white; border-radius: 15px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);">
            <!-- Multivariate R² equation box -->
            <div class="equation-box equation-wide" style="margin: 0 auto 20px auto; width: 320px;">
                <p class="equation-title">Multivariate R² formula</p>
                <div class="equation-content">
                    \[R^2 = \frac{\sum_{i=1}^{n} r_i^2 - \sum_{i \neq j} r_i r_j r_{ij}}{1 - \sum_{i \neq j} r_{ij}^2}\]
                </div>
            </div>
            
            <div class="form-container" style="padding: 0 20px; padding-top: 10px; padding-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 1.1em; color: #555;">Needed R²</span>
                    <input type="number" id="needed-r2" min="0.1" max="0.9" step="0.01" value="0.6" style="width: 60px; margin-right: 0; padding: 5px; border: 1px solid #ccc; border-radius: 4px;" required>
                </div>
                
                <!-- Predictor correlation slider -->
                <div style="display: flex; flex-direction: column; margin-top: 30px;">
                    <input type="range" id="predictor-correlation-slider" min="0.1" max="0.9" step="0.01" value="0.2" style="width: 100%; accent-color: #222222;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                        <span style="font-size: 1.1em; color: #555;">Correlation of each predictor (r)</span>
                        <input type="number" id="predictor-correlation" min="0.1" max="0.9" step="0.01" value="0.2" style="width: 60px; margin-right: 0; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                </div>
                
                <!-- Collinearity slider -->
                <div style="display: flex; flex-direction: column; margin-top: 30px;">
                    <input type="range" id="collinearity-slider" min="0" max="0.9" step="0.01" value="0.1" style="width: 100%; accent-color: #222222;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                        <span style="font-size: 1.1em; color: #555;">Collinearity among predictors</span>
                        <input type="number" id="collinearity" min="0" max="0.9" step="0.01" value="0.1" style="width: 60px; margin-right: 0; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                </div>
                
                <!-- Number of predictors slider -->
                <div style="display: flex; flex-direction: column; margin-top: 30px;">
                    <input type="range" id="num-predictors-r2-slider" min="1" max="100" step="1" value="20" style="width: 100%; accent-color: #222222;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 2px;">
                        <span style="font-size: 1.1em; color: #555;">Number of predictors</span>
                        <input type="number" id="num-predictors-r2" min="1" max="100" step="1" value="20" style="width: 60px; margin-right: 0; padding: 5px; border: 1px solid #ccc; border-radius: 4px;">
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button id="record-r2" style="flex: 2; width: auto;">Record curve</button>
                    <button id="reset-r2" style="flex: 1; width: auto;">Reset</button>
                </div>
            </div>
        </div>
        
        <div class="section" style="padding: 20px;">
            <div id="r2PlotContainer" style="height: 500px;">
                <canvas id="r2Plot"></canvas>
            </div>
        </div>
    </div>

</div>


    <!-- Load scripts at the end of body -->
    <!-- Load libraries first -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <!-- Load shared plugins -->
    <script src="js/shared-plugins.js"></script>
    <!-- Load our module scripts -->
    <script src="js/binary.js"></script>
    <script src="js/continuous.js"></script>
    <!-- Load main.js last since it depends on the other scripts -->
    <script src="js/main.js"></script>
    <!-- Add this with your other script tags -->
    <script src="js/mahalanobis.js"></script>
    <!-- Add this before the closing body tag -->
    <script src="js/r-squared.js"></script>
</body>
</html> 